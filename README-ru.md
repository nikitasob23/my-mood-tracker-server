# Руководство My mood tracker server

## Обзор
Данное приложения является серверной частью мобильного приложения _Good mood_ - трекера ментального состояния здоровья. 
Пользователь вносит свои состояния настроения по нескольку раз в день, давая им оценку и указывая теги, которые как-то повлияли. Например, семья или друзья.
Задача сервера - регистрировать и авторизировать пользователей. А так же хранит данные и выступает в роли интерфейса для работы с ними.

## Микросервисы
My mood tracker server состоит из нескольких микросервисов, которые при совместной работе реализуют все функции, поставленные перед приложением

### 1. Config-service
Микросервис в своей локальной конфигурации собирает все общие файлы конфигурации из директорий _common-config_ в ресурсах каждого приложения и делится ими с другими микросервисами.

В режиме production настроена работа через github. Приложение загружает все файлы конфигурации из удаленного репозитория. Далее с помощью специального файла настройки (его имя можно задать в переменной repo.remote.git.properties-file) собирает все конфигурации в файлы для микросервисов и по запросу отдает их.

Более подробно с работой микросервиса можно ознакомиться в руководстве по использованию: **_config-service/README-ru.md_**

### 2. Database-service
Микросервис, предоставляющий REST API для работы с сущностями базы данных. С любыми данными можно взаимодействовать, обратившись к GET, POST, PUT или DELETE методам данного сервиса.

**Зависимости:**
Для функционирования данного микросервиса нужно несколько дополнительных зависимостей.
Все они должны быть запущены на одном из портов и доступны для database-service

- **Config-service** - предоставляет настройки для запуска микросервиса
- **MySQL** - база, в которой хранятся все данные на диске
- **Redis** - база, используемая для хранения кэша. 
Все загружаемые в основную базу данных сущности кэшируются с помощью данного сервиса.

### 3. Mail-sender
Сервис для отправки сообщений на почту пользователя. 
Он используется для подтверждения почты, посредством отправки ссылки с кодом активации при регистрации или смене названия почты.

**Зависимости:**

- **Config-service** - предоставляет настройки для запуска микросервиса
- **imap.yandex.ru** - сервера Яндекса, которые используются для отправки сообщений по протоколу IMAP.

Более подробно с работой микросервиса можно ознакомиться в руководстве по использованию: **_mail-sender/README-ru.md_**

### 4. Authorization-service
Микросервис, отвечающий за регистрацию, авторизацию и аутентификацию пользователей.
Регистрация происходит путем отправки запроса с почтой и паролем. Пользователь должен подтвердить почту с помощью высланного кода активации.
Авторизация и аутентификация происходит посредством access token, переданного в заголовке с Bearer.
Обновить токен доступа можно не только с помощью личных данных пользователя, но и с помощью refresh token, который генерируется вместе с access token.  


**Зависимости:**

- **Config-service** - предоставляет настройки для запуска микросервиса 
- **Database-service** - используется для доступа к пользовательским данным: проверяет существование пользователя и загружает новые данные.
- **Redis** - база, отвечающая за хранения кэшей authorization-service. 
Прежде, чем заносить данные о новом пользователе в базу с помощью database-service, они кэшируются вместе с кодом активации в redis и ждут, пока пользователь подтвердит свою почту
- **Mail-sender** - микросервис, который используется для отправки сообщений с кодом активации на почту новым пользователям.

### 5. Gateway-service
Микросервис, являющийся точкой входа во все приложение. Выполняет функции распределителя запросов между микросервисами. 
Так же защищает маршруты трафика, чтобы никто извне не мог получить доступ к другим микросервисам или чувствительным данным.

**Зависимости:**

- **Config-service** - предоставляет настройки для запуска микросервиса
- **Authorization-service** - проводит регистрацию, авторизацию и аутентификацию перед доступом к данным
- **Database-service** - предоставляет данные из базы

## Другие компоненты приложения
### 1. Domain
Модуль, который содержит в себе бизнес модели, dto, конвертеры и классы исключений, поддерживающие работу приложения.

### 2. Logger
Модуль, содержащий в себе набор классов, расширяющий работу стандартного для Spring логера Logback. 
ObjectStateLogger - класс, который к сообщению лога добавляет состояние объекта. 
При этом в настройках приложения можно указать, какие поля логируемых объектов нужно маскировать (например, пароли, токены и тд).
Более подробно с функционалом модуля можно ознакомиться в руководстве: **_logger/README-ru.md_**

### 3. Layer-connector
Модуль, обеспечивающий работу процессора аннотаций, который реализует автоматический маппинг моделей между классами разных слоев приложения.
Более подробно с функционалом модуля можно ознакомиться в руководстве: **_layer-connector/README-ru.md_**

### Дополнительные ссылки на документацию

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/docs/3.1.5/maven-plugin/reference/html/)
* [Create an OCI image](https://docs.spring.io/spring-boot/docs/3.1.5/maven-plugin/reference/html/#build-image)



















